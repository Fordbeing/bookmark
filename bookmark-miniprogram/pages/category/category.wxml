<!--pages/category/category.wxml-->
<view class="page">
  <!-- 固定头部 -->
  <view class="header">
    <text class="title">分类管理</text>
    <view class="add-btn" bindtap="showAddModal">+ 新建</view>
  </view>

  <!-- 可滚动列表区域 -->
  <scroll-view class="list" scroll-y>
    <!-- 空状态 -->
    <view class="empty" wx:if="{{!loading && categories.length === 0}}">
      <text class="empty-icon">📁</text>
      <text class="empty-text">暂无分类</text>
      <view class="empty-btn" bindtap="showAddModal">创建分类</view>
    </view>

    <!-- 加载中 -->
    <view class="loading" wx:if="{{loading}}">加载中...</view>

    <!-- 分类项 - 可滑动删除 -->
    <view 
      wx:for="{{categories}}" 
      wx:key="id"
      class="swipe-container"
    >
      <view 
        class="swipe-content"
        style="transform: translateX({{item.offsetX || 0}}rpx)"
        data-id="{{item.id}}"
        data-index="{{index}}"
        bindtouchstart="onTouchStart"
        bindtouchmove="onTouchMove"
        bindtouchend="onTouchEnd"
      >
        <view class="item" data-id="{{item.id}}" bindtap="goToCategoryBookmarks">
          <view class="item-icon">{{item.icon || '📁'}}</view>
          <view class="item-main">
            <view class="item-name">{{item.name}}</view>
            <view class="item-count">{{item.count || 0}} 个书签</view>
          </view>
          <view class="item-arrow">›</view>
        </view>
      </view>
      <!-- 操作按钮 -->
      <view class="swipe-actions">
        <view class="action-edit" data-id="{{item.id}}" bindtap="editCategory">编辑</view>
        <view class="action-delete" data-id="{{item.id}}" bindtap="deleteCategory">删除</view>
      </view>
    </view>
  </scroll-view>

  <!-- 弹窗 -->
  <view class="modal" wx:if="{{showModal}}" bindtap="hideModal">
    <view class="modal-box" catchtap="preventBubble">
      <view class="modal-title">{{editingId ? '编辑分类' : '新建分类'}}</view>
      
      <view class="form-item">
        <view class="form-label">名称</view>
        <input 
          class="form-input" 
          placeholder="输入分类名称" 
          value="{{modalForm.name}}"
          bindinput="onModalNameInput"
        />
      </view>

      <view class="form-item">
        <view class="form-label">图标</view>
        <view class="icon-list">
          <view 
            wx:for="{{iconOptions}}" 
            wx:key="*this"
            class="icon-opt {{modalForm.icon === item ? 'sel' : ''}}"
            data-icon="{{item}}"
            bindtap="selectIcon"
          >{{item}}</view>
        </view>
      </view>

      <view class="modal-btns">
        <view class="btn-cancel" bindtap="hideModal">取消</view>
        <view class="btn-save" bindtap="saveCategory">{{saving ? '保存中...' : '保存'}}</view>
      </view>
    </view>
  </view>
</view>
