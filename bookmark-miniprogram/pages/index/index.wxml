<!--pages/index/index.wxml-->
<view class="page">
  <!-- æœç´¢æ  -->
  <view class="search-section">
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        placeholder="æœç´¢ä¹¦ç­¾..." 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="handleSearch"
      />
      <text class="clear-btn" wx:if="{{searchKeyword}}" bindtap="clearSearch">âœ•</text>
    </view>
  </view>

  <!-- å¿«é€Ÿæ·»åŠ  -->
  <view class="quick-add-section">
    <input 
      class="url-input" 
      placeholder="ç²˜è´´é“¾æ¥å¿«é€Ÿæ·»åŠ " 
      value="{{inputUrl}}"
      bindinput="onUrlInput"
      bindconfirm="handleQuickAdd"
    />
    <button class="add-btn" bindtap="handleQuickAdd" loading="{{addLoading}}">æ·»åŠ </button>
  </view>

  <!-- åˆ†ç±»æ ‡ç­¾ -->
  <scroll-view class="category-tabs" scroll-x>
    <view class="tab {{currentFilter === 'all' ? 'active' : ''}}" bindtap="filterAll">
      å…¨éƒ¨ ({{bookmarks.length}})
    </view>
    <view class="tab {{currentFilter === 'favorite' ? 'active' : ''}}" bindtap="filterFavorite">
      â­ æ”¶è—
    </view>
    <view 
      wx:for="{{categories}}" 
      wx:key="id"
      class="tab {{currentFilter === 'category' && currentCategoryId === item.id ? 'active' : ''}}"
      data-id="{{item.id}}"
      bindtap="filterByCategory"
    >{{item.icon || 'ğŸ“'}} {{item.name}}</view>
  </scroll-view>

  <!-- ä¹¦ç­¾åˆ—è¡¨ -->
  <scroll-view 
    class="bookmark-list" 
    scroll-y 
    refresher-enabled
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onRefresh"
  >
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty" wx:if="{{!loading && filteredBookmarks.length === 0}}">
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-text">{{searchKeyword ? 'æœªæ‰¾åˆ°ç›¸å…³ä¹¦ç­¾' : 'æš‚æ— ä¹¦ç­¾'}}</text>
      <button class="empty-btn" bindtap="goToAddPage" wx:if="{{!searchKeyword}}">æ·»åŠ ä¹¦ç­¾</button>
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view class="loading" wx:if="{{loading}}">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- ä¹¦ç­¾å¡ç‰‡ - å¯æ»‘åŠ¨åˆ é™¤ -->
    <view 
      wx:for="{{filteredBookmarks}}" 
      wx:key="id"
      class="swipe-container"
    >
      <view 
        class="swipe-content"
        style="transform: translateX({{item.offsetX || 0}}rpx)"
        data-id="{{item.id}}"
        data-index="{{index}}"
        bindtouchstart="onTouchStart"
        bindtouchmove="onTouchMove"
        bindtouchend="onTouchEnd"
      >
        <view 
          class="bookmark-item"
          data-id="{{item.id}}"
          data-url="{{item.url}}"
          bindtap="handleCardTap"
          bindlongpress="showActionMenu"
        >
          <view class="item-icon">
            <text>{{item.title[0] || '?'}}</text>
          </view>
          <view class="item-content">
            <text class="item-title">{{item.title || item.url}}</text>
            <text class="item-url">{{item.url}}</text>
            <view class="item-meta">
              <text>{{item.formattedDate}}</text>
              <text wx:if="{{item.isFavorite === 1}}">â­</text>
            </view>
          </view>
        </view>
      </view>
      <!-- æ“ä½œæŒ‰é’® -->
      <view class="swipe-actions">
        <view class="action-edit" data-id="{{item.id}}" bindtap="goToEdit">ç¼–è¾‘</view>
        <view class="action-delete" data-id="{{item.id}}" bindtap="deleteBookmark">åˆ é™¤</view>
      </view>
    </view>
  </scroll-view>

  <!-- æµ®åŠ¨æ·»åŠ æŒ‰é’® -->
  <view class="fab" bindtap="goToAddPage">
    <text>+</text>
  </view>
</view>
