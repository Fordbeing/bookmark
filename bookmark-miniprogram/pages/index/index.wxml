<!--pages/index/index.wxml-->
<view class="index-page">
  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        type="text" 
        placeholder="æœç´¢ä¹¦ç­¾..." 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="handleSearch"
      />
      <text 
        class="clear-icon" 
        wx:if="{{searchKeyword}}" 
        bindtap="clearSearch"
      >âœ•</text>
    </view>
  </view>

  <!-- å¿«é€Ÿæ·»åŠ  -->
  <view class="quick-add card">
    <input 
      class="url-input" 
      type="text" 
      placeholder="ç²˜è´´é“¾æ¥ï¼šhttps://example.com" 
      value="{{inputUrl}}"
      bindinput="onUrlInput"
      bindconfirm="handleQuickAdd"
    />
    <view class="quick-add-btns">
      <button 
        class="btn btn-primary btn-sm" 
        bindtap="handleQuickAdd"
        loading="{{addLoading}}"
      >æ·»åŠ </button>
      <button class="btn btn-secondary btn-sm" bindtap="goToAddPage">æ‰‹å·¥æ·»åŠ </button>
    </view>
  </view>

  <!-- åˆ†ç±»ç­›é€‰ -->
  <scroll-view class="filter-tabs" scroll-x enable-flex>
    <view 
      class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}" 
      bindtap="filterAll"
    >
      <text>å…¨éƒ¨</text>
      <text class="count">{{bookmarks.length}}</text>
    </view>
    <view 
      class="filter-tab {{currentFilter === 'favorite' ? 'active' : ''}}" 
      bindtap="filterFavorite"
    >
      <text>â­ æ”¶è—</text>
    </view>
    <view 
      wx:for="{{categories}}" 
      wx:key="id"
      class="filter-tab {{currentFilter === 'category' && currentCategoryId === item.id ? 'active' : ''}}"
      data-id="{{item.id}}"
      bindtap="filterByCategory"
    >
      <text>{{item.icon || 'ğŸ“'}} {{item.name}}</text>
      <text class="count">{{item.count || 0}}</text>
    </view>
  </scroll-view>

  <!-- æ ‡é¢˜æ  -->
  <view class="header-bar">
    <text class="title">{{filterTitle}}</text>
    <text class="count-badge">{{filteredBookmarks.length}}ä¸ª</text>
  </view>

  <!-- ä¹¦ç­¾åˆ—è¡¨ -->
  <scroll-view 
    class="bookmark-list" 
    scroll-y 
    enable-back-to-top
    refresher-enabled
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onRefresh"
  >
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && filteredBookmarks.length === 0}}">
      <text class="icon">ğŸ“­</text>
      <text class="text">{{searchKeyword ? 'æœªæ‰¾åˆ°ç›¸å…³ä¹¦ç­¾' : 'æš‚æ— ä¹¦ç­¾'}}</text>
      <button class="btn btn-primary btn-sm mt-md" bindtap="goToAddPage" wx:if="{{!searchKeyword}}">æ·»åŠ ä¹¦ç­¾</button>
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view class="loading" wx:if="{{loading}}">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- ä¹¦ç­¾å¡ç‰‡ -->
    <view 
      wx:for="{{filteredBookmarks}}" 
      wx:key="id"
      class="bookmark-card card"
      data-id="{{item.id}}"
      data-url="{{item.url}}"
      bindtap="handleCardTap"
      bindlongpress="showActionMenu"
    >
      <!-- å¤´éƒ¨ -->
      <view class="card-header">
        <view class="card-icon">
          <text>{{item.title[0] || '?'}}</text>
        </view>
        <view class="card-title-wrapper">
          <text class="card-title truncate">{{item.title || item.url}}</text>
          <text class="card-url truncate">{{item.url}}</text>
        </view>
        <text class="favorite-star" wx:if="{{item.isFavorite === 1}}">â­</text>
      </view>

      <!-- æè¿° -->
      <text class="card-desc line-clamp-2">{{item.description || 'æš‚æ— æè¿°...'}}</text>

      <!-- æ ‡ç­¾ -->
      <view class="card-tags" wx:if="{{item.parsedTags && item.parsedTags.length > 0}}">
        <text 
          class="tag" 
          wx:for="{{item.parsedTags}}" 
          wx:for-item="tag" 
          wx:key="*this"
        >{{tag}}</text>
      </view>

      <!-- åº•éƒ¨ -->
      <view class="card-footer">
        <view class="card-meta">
          <text class="meta-item">ğŸ• {{item.formattedDate}}</text>
          <text class="meta-item" wx:if="{{item.visitCount}}">ğŸ‘ {{item.visitCount}}</text>
        </view>
        <view class="card-actions">
          <button class="action-btn" data-url="{{item.url}}" catchtap="copyUrl">ğŸ“‹</button>
          <button class="action-btn" data-id="{{item.id}}" catchtap="goToEdit">âœï¸</button>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- æµ®åŠ¨æ·»åŠ æŒ‰é’® -->
  <view class="fab" bindtap="goToAddPage">
    <text>+</text>
  </view>
</view>
